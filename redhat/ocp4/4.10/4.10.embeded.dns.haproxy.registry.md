# openshift4 内置 dns, haproxy, image registry

openshift4 虽然号称支持单节点，3节点的边缘部署模式，但是实际项目实施的时候，往往需要多一个节点，这个节点需要承载的认为有：
- DNS服务 : 因为k8s的各种内部服务，都依赖DNS解析
- load balancer 服务 : 3 k8s master是需要负载均衡服务的。
- 镜像仓库 : 这个是因为crio会在系统重启的时候，检查是否是意外重启，如果是，会清空本机镜像缓存，重新从镜像仓库下载。

我们还知道，openshift4 本身就是基于 rhcos / coreos 操作系统之上的 k8s， 我们当然可以把上述的服务，内嵌到 rhcos / coreos 里面去，实现真正意义上的 单节点/3节点 的部署模式。

以下是架构设计：

![](./dia/4.10.embed.dns.haproxy.registry.drawio.svg)

如果没有这个架构，那么我们的部署会是这个样子的：


