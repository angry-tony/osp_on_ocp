# nepdemo cd deploy

# vultr 

```bash
# sync content to cloud
rm -rf /data/ocp4/

mkdir -p /data/ocp4/
cd /data/ocp4

export BUILDNUMBER=4.10.35

wget -O openshift-client-linux-${BUILDNUMBER}.tar.gz https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/${BUILDNUMBER}/openshift-client-linux-${BUILDNUMBER}.tar.gz
wget -O openshift-install-linux-${BUILDNUMBER}.tar.gz https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/${BUILDNUMBER}/openshift-install-linux-${BUILDNUMBER}.tar.gz

tar -xzf openshift-client-linux-${BUILDNUMBER}.tar.gz -C /usr/local/sbin/
tar -xzf openshift-install-linux-${BUILDNUMBER}.tar.gz -C /usr/local/sbin/


rm -rf /data/ocp4/

mkdir -p /data/ocp4/tmp
cd /data/ocp4/tmp
git clone https://github.com/wangzheng422/openshift4-shell
cd openshift4-shell
git checkout ocp-4.11
/bin/cp -f prepare.content.with.oc.mirror.sh /data/ocp4/

rm -rf /data/ocp4/tmp

cd /data/ocp4

bash prepare.content.with.oc.mirror.sh -v ${BUILDNUMBER}, -m ${BUILDNUMBER%.*} -b ocp-4.11

# download from cloud
cd /root/tmp/ocp4.10 && \
  rsync -e ssh --info=progress2 -P --delete -arz root@v.wzhlab.top:/data/ocp4/ ./

# sync to cd
cd /root/tmp/ocp4.10 && \
  rsync -e "ssh -J root@baicell.redhat.ren" --info=progress2 -P --delete -arz  ./ root@172.19.3.60:/data/ocp4/

```

# connection

```bash

ssh -tt -R 18801:10.147.17.89:5085 -J root@baicell.redhat.ren root@172.19.3.60

```

# mirror

```bash

mkdir -p /data/ocp4
cd /data/ocp4

export BUILDNUMBER=4.10.35
wget -O oc-mirror.tar.gz https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/$BUILDNUMBER/oc-mirror.tar.gz

tar -xzf oc-mirror.tar.gz -C /usr/local/bin/
chmod +x /usr/local/bin/oc-mirror

SEC_FILE="$XDG_RUNTIME_DIR/containers/auth.json"
# $XDG_RUNTIME_DIR/containers
mkdir -p ${SEC_FILE%/*}

cat > /data/ocp4/mirror.yaml << EOF
apiVersion: mirror.openshift.io/v1alpha1
kind: ImageSetConfiguration
# archiveSize: 4
mirror:
  ocp:
    channels:
      - name: stable-4.10
        versions:
          - '4.10.35'
EOF


mkdir -p /data/install
cd /data/install

oc-mirror --config /data/ocp4/mirror.yaml file:///data/install/

# download from cloud
cd /root/tmp/ocp-mirror.4.10 && \
  rsync -e ssh --info=progress2 -P --delete -arz root@v.wzhlab.top:/data/install/ ./


```